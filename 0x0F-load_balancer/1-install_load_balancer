#!/usr/bin/env bash
# install HAproxy in my lb-01 server.
sudo apt -y update
sudo apt -y install haproxy
# backup
cp /etc/haproxy/haproxy.cfg ~/backups/haproxy.cfg

# config file for HAProxy
sudo bash -c "cat <<EOF >> /etc/haproxy/haproxy.cfg
frontend khalid77.tech
    bind *:80
    stats uri /haproxy?stats
    default_backend web_servers

backend web_servers
    balance roundrobin
    server 510461-web-01 34.203.38.10 check
    server 510461-web-02 54.175.223.87 check
EOF"

sudo bash -c 'echo "ENABLED=1" >> /etc/default/haproxy'
sudo service haproxy restart
