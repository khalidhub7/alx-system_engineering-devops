#!/usr/bin/env bash
#  set custom header in my 2nd server

sudo apt -y update
sudo apt -y upgrade
sudo apt -y install nginx

sudo chown -R ubuntu /var/www/
sudo mkdir -p /var/www/html/
echo "Hello World!" > /var/www/html/index.html

sudo chown -R ubuntu /usr/share/nginx/
echo "Ceci n'est pas une page\n" > /usr/share/nginx/html/404.html

#  variables to change server {}
redirect_line="https://www.google.fr/"
comment="# im khalid and this is a server confg"
path="/etc/nginx/sites-available/default"
sudo sed -i "/^}$/i \\n\tlocation /redirect_me {\\n\t\treturn 301 $redirect_line;\\n\t\t$comment\\n\t}\\n" $path

sudo sed -i "/^}$/i \\n\terror_page 404 /404.html;\\n\tlocation = /404.html {\\n\t\troot /usr/share/nginx/html;\\n\t\tinternal;\\n\t\t$comment\\n\t}\\n" $path

sudo sed -i "/^}$/i \ \n\tadd_header X-Served-By $HOSTNAME;\t\n" $path
